var PathOS=PathOS||{};PathOS.version="PathOS.js build: 26th of May 2016",PathOS.data={load:function(e,t){var a=t||{};return localStorage["PathOS-"+e]&&(a=JSON.parse(localStorage["PathOS-"+e])),a},save:function(e,t){localStorage["PathOS-"+e]=JSON.stringify(t)},clear:function(e){delete localStorage["PathOS-"+e]},clean:function(){delete localStorage["PathOS-history"],delete localStorage.PathOSHistory,delete localStorage["PathOS-modules"]}},PathOS.module=function(e){function t(e){var t="";e.title.toLowerCase().indexOf("seqrun")>=0?t="Seqrun":e.title.toLowerCase().indexOf("pubmed")>=0?t="Pubmed":e.title.toLowerCase().indexOf("sequenced variants list")>=0?t="SeqSample":e.title.toLowerCase().indexOf("curvar")>=0?t="CurVariant":e.title.toLowerCase().indexOf("patient")>=0&&(t="PatSample");var a=p.append("tr");a.append("td").append("a").attr("href",e.url).text(e.title).classed(t,!0),a.append("td").text(PathOS.timeSince(e.time))}var a=this;PathOS.modules.map[e.name]={data:e,object:a};var n=d3.select("#"+e.name);n.empty()&&(n=this.div=d3.select("#sidebar").append("div").classed("module",!0).attr("id",e.name));var o=n.select(".moduletitle");if(o.empty()?(o=n.append("table").classed("moduletitle",!0).append("tr"),o.append("td").classed("modulelabel",!0).datum(e).on("click",a.toggle).append("a").attr("href","#"+e.name).append("h1").text(e.title)):o.select("td").classed("modulelabel",!0).datum(e).on("click",a.toggle),o.insert("td","td").datum(e).on("click",a.toggle).append("a").attr("href","#"+e.name).append("i").classed("fa fa-minus-square minimise",!0),e.type){var s=n.append("div").classed("content",!0);switch(e.type){case"tags":var i=o.append("td").attr("id","tags_edit_button").on("click",function(){$("#tags").toggleClass("editing"),$("#tags_edit_button i").toggleClass("fa-pencil-square-o"),$("#tags_edit_button i").toggleClass("fa-pencil-square")}).append("a").attr("href","#"+e.name);i.append("span").html("(Editing)&nbsp;"),i.append("i").classed("button fa fa-pencil-square-o",!0),o.append("td").append("a").attr("href","#"+e.name).append("i").classed("fa fa-times",!0).style("padding-bottom","1px").on("click",function(t){d3.select("#"+e.name).style("display","none"),e.closeModule()}),d3.select("#tags").style("display","none");var l=s.append("table").append("thead").append("tr").classed("row",!0);l.append("th").text(e.data.object),l.append("th").text("").attr("id","object_id").style("text-align","right");var d=s.append("div").classed("fb-box tags_field",!0).attr("id","moduleTagBox").on("click",function(){$("#tag_text_area").focus()});e.data.tags.forEach(function(e){PathOS.tags.drawTag(d,e,!0)}),d.append("textarea").attr("id","tag_text_area").attr("placeholder","Enter Tags Here"),$("#tag_text_area").autocomplete({source:e.data.availableTags}),$("body").on("keydown",function(e){if(e&&e.keyCode&&13==e.keyCode&&$(document.activeElement).is("#tag_text_area")){var t=$("#tag_text_area").val().trim();$("#tag_text_area").val(""),t&&""!==t&&PathOS.tags.current_object&&PathOS.tags.addTag(d,t)}else if(e&&e.keyCode&&8==e.keyCode&&$(document.activeElement).is("#tag_text_area")&&""===$("#tag_text_area").val()&&0!==$("#moduleTagBox.tags_field .tagdiv:last").length)if($("#moduleTagBox.tags_field .tagdiv:last").hasClass("deleteFlag")){var a=d3.select($("#moduleTagBox.tags_field .tagdiv:last")[0]).datum();if(confirm('Remove tag "'+a.label+'" from this object?')){var n={type:PathOS.controller,objid:PathOS.tags.current_object,tagid:a.id};$.ajax({type:"DELETE",url:"/PathOS/tag/removeLink?"+$.param(n),success:function(e){"fail"!=e&&$(".tag-"+a.id).remove()},cache:!1,contentType:!1,processData:!1})}}else $("#moduleTagBox.tags_field .tagdiv:last").toggleClass("deleteFlag").on("click",function(){var e=d3.select($("#moduleTagBox.tags_field .tagdiv:last")[0]).datum(),t={type:PathOS.controller,objid:PathOS.tags.current_object,tagid:e.id};$.ajax({type:"DELETE",url:"/PathOS/tag/removeLink?"+$.param(t),success:function(t){"fail"!=t&&$(".tag-"+e.id).remove()},cache:!1,contentType:!1,processData:!1})})});break;case"history":var r=s.append("table"),c=r.append("thead").append("tr"),p=r.append("tbody");c.append("th").text("Page"),c.append("th").text("T"),e.data.forEach(t),p.append("span").append("a").attr("href","#").text("See more").on("click",function(){PathOS.history.more().forEach(t),$(this).remove()});break;case"established":s.remove();break;default:var h=s.append("ul").style("clip","rect(0px, 1000px, 0px, 0px)");e.data instanceof Array?e.data.forEach(function(e){h.append("li").html(e)}):Object.keys(e.data).forEach(function(t){h.append("li").html(t+": "+e.data[t])})}}(n.classed("hide")||e.hide)&&(n.classed("hide",!1),a.toggle(e.name))},PathOS.module.prototype.toggle=function(e){d3.event&&d3.event.preventDefault();var t="string"==typeof e?e:d3.select(this).datum().name,a="#"+t;$(a).toggleClass("hidden"),$(a+" i.minimise").toggleClass("fa-minus-square"),$(a+" i.minimise").toggleClass("fa-plus-square");var n=$(a).height();d3.select(a).classed("hidden")?(d3.select(a).style("min-height","1px"),PathOS.user&&(PathOS.modules.settings[PathOS.user].hide[t]=!0,PathOS.data.save("modules",PathOS.modules.settings))):(d3.select(a).style("min-height",n+"px"),PathOS.user&&(delete PathOS.modules.settings[PathOS.user].hide[t],PathOS.data.save("modules",PathOS.modules.settings)))},PathOS.module.prototype.data=function(){var e=d3.select(this).datum();console.log(e)},PathOS.modules={menuVisible:!1,settings:{},map:{},init:function(e){console.log("loading module settings"),PathOS.modules.settings=PathOS.data.load("modules"),PathOS.controller=e.controller,PathOS.action=e.action,e.user&&(PathOS.user=e.user,PathOS.modules.settings[PathOS.user]?(Object.keys(PathOS.modules.settings[PathOS.user].hide).forEach(function(e){document.getElementById(e)&&!d3.select("#"+e).classed("hidden")&&(PathOS.modules.map[e]?PathOS.modules.map[e].object.toggle(e):d3.select("#"+e).classed("hide",!0))}),PathOS.modules.settings[PathOS.user].sidebar[window.location.pathname]&&("show"==PathOS.modules.settings[PathOS.user].sidebar[window.location.pathname]?(d3.select("#wrapper").classed("toggled",!1),d3.select("#sidebar-toggle i").classed("fa-chevron-left",!1),d3.select("#sidebar-toggle i").classed("fa-chevron-right",!0)):"hide"==PathOS.modules.settings[PathOS.user].sidebar[window.location.pathname]&&(d3.select("#wrapper").classed("toggled",!0),d3.select("#sidebar-toggle i").classed("fa-chevron-left",!0),d3.select("#sidebar-toggle i").classed("fa-chevron-right",!1)))):(PathOS.modules.settings[PathOS.user]={sidebar:{},hide:{},svlistIGV:"ask"},PathOS.data.save("modules",PathOS.modules.settings))),d3.select("#sidebar-footer").append("span").append("a").attr("href","#").on("click",function(){PathOS.modules.menuVisible?PathOS.modules.menu.hide():PathOS.modules.menu.show()}).append("i").attr("class","fa-lg fa fa-cog").attr("aria-hidden","true")},menu:{show:function(){function e(){d3.selectAll("#IGV-options a").classed("selected",!1)}console.log("showing settings!");var t=d3.select("body").append("div").attr("id","overlay").on("click",PathOS.modules.menu.hide).append("div").on("click",function(){d3.event.stopPropagation()}).attr("id","moduleMenu").classed("fb-box",!0);if(t.append("a").attr("href","#").on("click",PathOS.modules.menu.hide).append("i").classed("fa fa-close fa-lg",!0),menu=t.append("div"),header=menu.attr("id","mmHeader").append("h1").text("PathOS Options"),PathOS.user){var a=menu.append("p").attr("id","IGV-options").text("IGV.js Options: ");if(a.append("p").text("In-browser IGV (also known as IGV.js) can load in the background while you browse PathOS. It can also downsample reads, which will make larger runs easier for your computer to handle."),a.append("a").attr("href","#").attr("id","svlist-igv-auto").text("Auto Load (no downsampling)").on("click",function(){e(),d3.select(this).classed("selected",!0),PathOS.modules.settings[PathOS.user].svlistIGV="auto",PathOS.data.save("modules",PathOS.modules.settings)}),a.append("a").attr("href","#").attr("id","svlist-igv-downsample").text("Auto Load (downsample to 2500)").on("click",function(){e(),d3.select(this).classed("selected",!0),PathOS.modules.settings[PathOS.user].svlistIGV="downsample",PathOS.data.save("modules",PathOS.modules.settings)}),a.append("a").attr("href","#").attr("id","svlist-igv-ask").text("Ask Before Loading IGV.js").on("click",function(){e(),d3.select(this).classed("selected",!0),PathOS.modules.settings[PathOS.user].svlistIGV="ask",PathOS.data.save("modules",PathOS.modules.settings)}),PathOS.modules.settings[PathOS.user]){var n=PathOS.modules.settings[PathOS.user].svlistIGV;"undefined"==typeof n||"ask"==n?d3.select("#svlist-igv-ask").classed("selected",!0):"downsample"==n?d3.select("#svlist-igv-downsample").classed("selected",!0):"auto"==n&&d3.select("#svlist-igv-auto").classed("selected",!0)}menu.append("p").text("PathOS History: ").append("a").text("Clear History").attr("href","#").attr("id","clearHistory").on("click",function(){PathOS.data.clear("history"),alert("History Cleared!")})}var o=menu.append("p").attr("id","pathos-menu-links").text("Links to: ");o.append("a").attr("href","https://115.146.86.118/jira/secure/Dashboard.jspa").text("Jira"),o.append("span").text(" - "),o.append("a").attr("href","https://115.146.86.118/confluence/display/PVS/PathOS+Variant+System").text("Confluence"),o.append("span").text(" - "),o.append("a").attr("href","http://pathos.co/help").text("Help"),PathOS.hotkeys.off(),$("body").on("keydown",function(e){!e||!e.keyCode||27!=e.keyCode||$(document.activeElement).is("input")||$(document.activeElement).is("textarea")||e.altKey||e.metaKey||e.ctrlKey||PathOS.modules.menu.hide()})},hide:function(){console.log("hiding settings!"),d3.select("#overlay").remove(),PathOS.hotkeys.init()}}},PathOS.svlist={evidence:{pathAloneTruncating:"Truncating variant (nonsense, frameshift, canonical splice site, initiation codon) in a known tumour suppressor gene",pathAloneKnown:"Same missense change as a previously established pathogenic variant",pathStrongFunction:"Well-established in vitro or in vivo functional studies support a deleterious effect on the gene or gene product",pathStrongCase:"Case-control studies show enrichment in cases",pathStrongCoseg:"<b><i>For familial cancer only:</i></b> Proband's family study shows co-segregation with cancer",pathSupportHotspot:"Located near a known mutational hot-spot or within a well-characterised functional domain",pathSupportGene:"Occurs in a gene with high clinical specificity and sensitivity for the cancer",pathSupportInsilico:"Multiple types of computational evidence support a deleterious effect on the gene or gene product (PolyPhen, SIFT, Mutation Taster ,conservation, evolution, splicing)",pathSupportSpectrum:"Type of variant fits known mutation spectrum for the gene",pathSupportGmaf:"Absent from ESP and 1000 Genomes data, or frequency is below highest global minor allele frequency (GMAF) expected for autosomal dominant disease (0.4%)",pathSupportIndel:"In-frame deletion/insertion in a well characterised functional domain",pathSupportNovelMissense:"Novel missense change at an amino acid where a different missense change is pathogenic",pathSupportLsdb:"Noted as pathogenic in a curated locus specific database",pathSupportCoseg:"<b><i>For familial cancer only:</i></b> Proband's family study shows co-segregation with disease",benignAloneGmaf:"Exists in ESP and 1000 Genomes >= 0.4% GMAF",benignAloneHealthy:"<b><i>For familial cancer only:</i></b> For a fully penetrant cancer syndrome, observed in a healthy adult individual",benignStrongFunction:"Well-established in vitro or in vivo functional studies shows no deleterious effect on protein function or splicing",benignStrongCase:"Case control studies show comparable frequencies",benignStrongCoseg:"<b><i>For familial cancer only:</i></b> Variant fails to co-segregate with disease in a family study",benignSupportVariable:"Located in a region without a characterised function or away from known mutation hot-spots",benignSupportInsilico:"Multiple types of computational evidence suggest no impact on gene or gene product (PolyPhen, SIFT, Mutation Taster, conservation, evolution, splicing)",benignSupportSpectrum:"Type of variant does not fit known mutation spectrum for the gene",benignSupportLsdb:"Noted as benign in a curated locus specific database",benignSupportPath:"<b><i>For familial cancer only:</i></b> For a fully penetrant cancer syndrome, observed with another pathogenic variant in the same individual"},ccc:function(e,t){var a=!1;return null===e||null===t?null===e&&null===t&&(a=!0):e.id==t.id&&(a=!0),a},createCV:function(e){console.log("Ok, I guess we're making a CV now..."),console.log("Your sv is: "+e),console.log(this);var t=$("#newCVcc").val(),a={id:e,cc:t};$.ajax({type:"POST",url:"/PathOS/CurVariant/newCV?"+$.param(a),success:function(e){"string"==typeof e?alert(e):console.log(e)},cache:!1,contentType:!1,processData:!1})},saveCV:function(e){var t="fail",a="lol";t=$("#cv-"+e+" .report").val(),a=$("#cv-"+e+" .evidence").val();var n={id:e,report:t,evidence:a};$.ajax({type:"POST",url:"/PathOS/CurVariant/updateCV?"+$.param(n),success:function(e){"string"==typeof e?alert(e):console.log(e)},cache:!1,contentType:!1,processData:!1}),console.log("Trying to save: "+e),console.log("report is: "+t),console.log("evidence is: "+a)},showCVs:function(e){function t(e,t){t.select("table").remove();var a=t.append("table").attr("id","svInfoTable").classed("infoTable",!0),n=a.append("tbody");Object.keys(e).forEach(function(t){var a=n.append("tr");a.append("td").html(t).classed("property-label",!0),a.append("td").html(e[t]).classed("property-value",!0)})}console.log("Showing all Curated Variants for this Sequenced Variant");var a=d3.select("body").append("div").attr("id","overlay").on("click",PathOS.svlist.closeCV).append("div").on("click",function(){d3.event.stopPropagation()}).attr("id","show-cv").classed("fb-box",!0).classed("container",!0);a.append("a").attr("href","#").on("click",PathOS.svlist.closeCV).append("i").classed("fa fa-close fa-lg",!0);var n=a.append("div");n.append("img").classed("loading_logo",!0).attr("id","cv-loading").attr("src","/PathOS/dist/img/pathos_logo_animated.svg"),$.ajax("/PathOS/SeqVariant/lookUpCVs?id="+e,{success:function(a){function o(e,t){var n="Generic",o=e.id;e.clinContext&&(n=a.lookup.context[e.clinContext.id]),g=u.append("tr").classed("current-context-cv",t),t?g.append("td").append("h2").html("Current Context<br>").append("a").attr("href","/PathOS/curVariant/show?id="+e.id).text(n):g.append("td").append("a").attr("href","/PathOS/curVariant/show?id="+e.id).text(n),g.append("td").append("textarea").attr("readonly",!0).style("width","100%").text(e.reportDesc),g.append("td").append("textarea").attr("readonly",!0).style("width","100%").text(e.evidence.justification),f=g.append("td");var s=e.pmClass.split(":")[0];f.append("p").text(e.pmClass).classed("cvlabel cv-"+s,!0);var i=0,l=f.append("a").attr("href","#none").on("click",function(e){console.log("cliccckinggggg"),$("#evidence-list-"+o).toggleClass("hidden")}),d=f.append("ul").attr("id","evidence-list-"+o).classed("hidden",!0);Object.keys(PathOS.svlist.evidence).forEach(function(t){e.evidence[t]&&(i++,d.append("li").html(PathOS.svlist.evidence[t]))}),l.text("Show Evidence ("+i+")")}d3.select("#cv-loading").remove(),console.log(a);n.attr("id","cvHeader").append("h1").text("Sequenced Variant: "+a.sv.hgvsc);console.log("SV id is: "+e);var s=n.append("div").attr("id","sv-info").classed("row",!0),i=s.append("div").classed("fb-box",!0).classed("col-xs-5 col-xs-offset-1",!0).attr("id","sv-infobox-div");i.append("h2").text("Sequenced Variant information:"),svClinContext="None",a.sv.clinContext&&(svClinContext=a.lookup.context(a.sv.context.id));var l={Gene:a.sv.gene,HGVSC:a.sv.hgvsc,HGVSG:a.sv.hgvsg,HGVSP:a.sv.hgvsp,"Clinical Context (from sample)":svClinContext,Consequences:a.sv.consequence,"Variant Caller":a.sv.varcaller,"Amplicon Count":a.sv.numamps,"Amplicon Bias":a.sv.ampbias},d={"Variant Frequency":a.sv.varFreq,"Variant Depth":a.sv.varDepth,"Panel Var %":d3.format(".4")(a.sv.varPanelPct)+"%",dbSNP:a.sv.dbsnp,"GMAF %":a.sv.gmaf,"ESP %":a.sv.esp,"ExAC %":a.sv.exac,Cosmic:a.sv.cosmic?"<a target='_blank' href='/PathOS/seqVariant/cosmicAction?id='"+a.sv.id+" title='"+a.sv.cosmicOccurs+"'>COSM"+a.sv.cosmic+"</a>":"",Exon:a.sv.exon,Cytoband:a.sv.cytoband,"CADD Raw":d3.format("(.2f")(a.sv.cadd),"CADD Scaled":d3.format("(.2f")(a.sv.cadd_phred)};t(l,i);var r=s.append("div").classed("fb-box",!0).classed("col-xs-5",!0).attr("id","cv-infobox-div");t(d,r),n.append("h1").text("Curated Variants:");var c=n.append("div").classed("row",!0).attr("id","cv-list"),p=c.append("table"),h=p.append("thead").append("tr");h.append("th").text("Context").style("width","15%"),h.append("th").text("Report Description"),h.append("th").text("Evidence Description"),h.append("th").text("Classification");var u=p.append("tbody"),g=null,f=null;a.generic&&(a.currentCV&&a.currentCV.id!=a.generic.id?(o(a.generic,!1),o(a.currentCV,!0)):o(a.generic,!0)),a.otherCVs.forEach(function(e){o(e,!1)})}}),PathOS.hotkeys.off(),$("body").on("keydown",function(e){!e||!e.keyCode||27!=e.keyCode||$(document.activeElement).is("input")||$(document.activeElement).is("textarea")||e.altKey||e.metaKey||e.ctrlKey||PathOS.svlist.closeCV()})},closeCV:function(){console.log("closing CV!"),d3.select("#overlay").remove(),PathOS.hotkeys.init()}},PathOS.buildBlock=function(e,t){t.forEach(function(t){var a=e.append("p");t.link&&""!==t.link?(a.append("span").classed("bold",!0).text(t.title+": "),a.html(a.html()+'<a href="'+t.link+'">'+t.words+"</a>")):(a.append("span").classed("bold",!0).text(t.title+": "),a.html(a.html()+t.words))})},PathOS.classify=function(e){return e.toLowerCase().replace(" ","-")},PathOS.params=function(){params={};var e=window.location.search.substring(1),t=e.split("&");return t.forEach(function(e){if(e.indexOf("=")>0){var t=e.split("=");params[t[0]]=t[1].indexOf(",")>=0?t[1].split(","):t[1]}}),params},PathOS.evidence={benignAloneGmaf:"Benign Stand-alone Gmaf",benignAloneHealthy:"Benign Stand-alone Healthy",benignStrongCase:"Benign Stand-alone Strong-case",benignStrongCoseg:"Benign Stand-alone Coseg",benignStrongFunction:"Benign Strong Function",benignSupportInsilico:"Benign Support Insilico",benignSupportLsdb:"Benign Support Local Sequence Database",benignSupportPath:"Benign Support Pathology",benignSupportSpectrum:"Benign Support Spectrum",benignSupportVariable:"Benign Support Variable",pathAloneKnown:"Pathology Stand-alone Known",pathAloneTruncating:"Pathology Stand-alone Truncating",pathStrongCase:"Pathology Strong Case",pathStrongCoseg:"Pathology Strong Coseg",pathStrongFunction:"Pathology Strong Function",pathSupportCoseg:"Pathology Support Coseg",pathSupportGene:"Pathology Support Gene",pathSupportGmaf:"Pathology Support Gmaf",pathSupportHotspot:"Pathology Support Hotspot",pathSupportIndel:"Pathology Support Indel",pathSupportInsilico:"Pathology Support Insilico",pathSupportLsdb:"Pathology Support Local Sequence Database",pathSupportNovelMissense:"Pathology Support Novel Missense",pathSupportSpectrum:"Pathology Support Spectrum"},PathOS.hotkeys={keys:{27:function(){d3.selectAll(".tagdiv .tooltip.edit").classed("edit",!1)}},add:function(e,t){this.keys[e]=t},off:function(){$("body").off("keydown")},init:function(){var e=this.keys;$("body").on("keydown",function(t){!(t&&t.keyCode&&e[t.keyCode])||$(document.activeElement).is("input")||$(document.activeElement).is("textarea")||t.altKey||t.metaKey||t.ctrlKey||e[t.keyCode]()})},testMode:function(){var e=this.keys;$("body").on("keydown",function(t){!t||!t.keyCode||$(document.activeElement).is("input")||t.altKey||t.metaKey||t.ctrlKey||(console.log("You pushed: "+t.keyCode),e[t.keyCode]&&(console.log("It has this function:"),console.log(e[t.keyCode])))})}};var months=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"];PathOS.date=function(e,t){var a="";if(Date.parse(e)>0){var n=e.split("T")[0].split("-");a=t&&"full"==t?n[2]+" "+months[parseInt(n[1])-1]+" "+n[0]:n[2]+" "+months[parseInt(n[1])-1]}return a},PathOS.timeSince=function(e){var t="",a=Date.parse(e),n=Date.now(),o=n-a;return a>0&&(t=o<36e5?Math.floor(o/6e4)+"m":o<864e5?Math.floor(o/36e5)+"h":Math.floor(o/864e5)+"d"),t},PathOS.addOption=function(e,t,a,n){var o=e.append("label");o.append("input").attr("class","option").attr("id","option-"+a).attr("type","checkbox"),o.html(o.html()+" "+t+"<br>"),o.on("change",function(){$("."+a).toggleClass(a+"-toggle"),localStorage[a+"-option"]=document.getElementById("option-"+a).checked}),n?"undefined"!=typeof localStorage[a+"-option"]&&localStorage[a+"-option"]!==!0&&"true"!=localStorage[a+"-option"]||(o.select("input").attr("checked",n),d3.selectAll("."+a).classed(a+"-toggle",!0)):("undefined"!=typeof localStorage[a+"-option"]&&localStorage[a+"-option"]===!0||"true"==localStorage[a+"-option"])&&(o.select("input").attr("checked",!0),d3.selectAll("."+a).classed(a+"-toggle",!0))},PathOS.history={json:[],add:function(e){PathOS.history.json.forEach(function(t,a){t.title==e.title&&PathOS.history.json.splice(a,1)}),PathOS.history.json.push(e),PathOS.history.json.length>50&&(PathOS.history.json=PathOS.history.json.slice(20)),PathOS.data.save("history",PathOS.history.json),localStorage.PathOSHistory=JSON.stringify(PathOS.history.json)},clear:function(){PathOS.history.json=[],PathOS.data.clear("history")},show:function(e){var t=PathOS.history.json,a=e||10;return(t.length<a?t:t.slice(t.length-a)).reverse()},more:function(){var e=PathOS.history.json,t=50;return(e.length<t?e:e.slice(e.length-t)).reverse().slice(10)},init:function(){PathOS.history.json=PathOS.data.load("history",[])}},PathOS.safety={change:!1,saved:!1,init:function(){$("textarea,input").keyup(function(){PathOS.safety.change=!0}),$(".savebutton").on("click",function(){PathOS.safety.saved=!0}),window.onbeforeunload=function(){if(PathOS.safety.change&&!PathOS.saftey.saved)return"Testing"}}},PathOS.tags={current_object:!1,update_object:function(e){PathOS.tags.current_object=e;var t={type:PathOS.controller,id:e};t.type&&e&&$.ajax({type:"GET",url:"/PathOS/tag/getTags?"+$.param(t),success:function(e){console.log(e),d3.select("#tags").style("display",""),$("#object_id").text(e.name),d3.selectAll("#tags .tagdiv").remove(),e.tags?e.tags.forEach(function(e){PathOS.tags.drawTag(d3.select("#tags .fb-box"),e,!0)}):PathOS.tags.nullObject(d3.select("#tags .fb-box"))},cache:!1,contentType:!1,processData:!1})},buildModule:function(e){console.log("Building tags module.");new PathOS.module({name:"tags",title:"Tags",type:"tags",data:e,closeModule:e.closeModule})},nullObject:function(e){e.insert("div",":first-child").classed("tagdiv",!0).append("label").text("You cannot add tags to it."),e.insert("div",":first-child").classed("tagdiv",!0).append("label").text("Sorry, this object has not be saved.")},drawTagById:function(e,t,a){$.ajax("/PathOS/Tag/lookUp?id="+t,{success:function(t){PathOS.tags.drawTag(e,t,a)}})},drawTag:function(e,t,a){if("fail"==t)alert("Sorry, you cannot set a reserved smart tag");else{var n=t.isAuto?e.insert("div",":first-child"):e.insert("div","textarea");n.attr("class","tagdiv tag-"+t.id).datum(t).classed("isAuto",t.isAuto).on("click",function(e){var t=this;if(!e.isAuto&&d3.select("#tags").classed("editing")){var a={type:PathOS.controller,objid:PathOS.tags.current_object,tagid:e.id};$.ajax({type:"DELETE",url:"/PathOS/tag/removeLink?"+$.param(a),success:function(e){"fail"!=e&&$(t).remove()},cache:!1,contentType:!1,processData:!1})}else d3.select(t).select(".tooltip").classed("dismiss",!0)}),n.append("span").text(t.label);var o=t.description||"Enter Description Here.",s=n.append("div").classed("tooltip fb-box",!0);s.append("button").text("Search").on("click",function(e){d3.event.stopPropagation(),window.location.href="/PathOS/search?q="+e.label}),s.append("button").text("View").on("click",function(e){d3.event.stopPropagation(),window.location.href="/PathOS/Tag/Show/"+e.id}),s.append("button").text("Edit").on("click",function(e){}),s.append("i").classed("fa fa-close fa-lg",!0).on("click",function(){d3.event.stopPropagation(),s.classed("edit",!1)}),a&&s.append("i").classed("fa fa-trash fa-lg",!0).on("click",function(){if(d3.event.stopPropagation(),confirm('Remove tag "'+t.label+'" from this object?')){var e={type:PathOS.controller,objid:PathOS.tags.current_object,tagid:t.id};$.ajax({type:"DELETE",url:"/PathOS/tag/removeLink?"+$.param(e),success:function(e){"fail"!=e&&$(".tag-"+t.id).remove()},cache:!1,contentType:!1,processData:!1})}}),s.append("i").classed("fa fa-check fa-lg",!0).on("click",function(){d3.event.stopPropagation(),s.classed("dismiss",!1)}),s.append("p").classed("tt_description",!0).text(o),s.append("input").attr("value",o).on("keydown",function(){var e=d3.event;if(e&&e.keyCode&&13==e.keyCode){var a={description:$(this).val(),id:t.id};$.ajax("/PathOS/Tag/putDescription?"+$.param(a),{success:function(){$(".tag-"+t.id+" input").val(a.description),$(".tag-"+t.id+" p").text(a.description),s.classed("edit",!1),s.classed("dismiss",!0)}})}}),s.on("click",function(e){d3.event.stopPropagation(),s.classed("edit",!0)})}},addTag:function(e,t,a,n){if("undefined"==typeof a&&(a=PathOS.controller),"undefined"==typeof n&&(n=PathOS.tags.current_object),a&&t&&n){var o={type:a,id:n,tag:t,user:PathOS.user};$.ajax({type:"POST",url:"/PathOS/tag/addTag?"+$.param(o),success:function(t){"string"==typeof t?alert(t):e.select(".tag-"+t.id).empty()&&(PathOS.tags.drawTag(e,t,!0),$("#tag_text_area").val(""))},cache:!1,contentType:!1,processData:!1})}else console.log("We don't have a controller, tag or id."),console.log(a),console.log(t),console.log(n)}},PathOS.printQC=function(e){var t=e.div.append("h4").classed("flag",!0);null===e.authorised?t.text("QC Not Set").classed("unknown",!0):e.passfailFlag?t.text("QC Passed").classed("passed",!0):e.passfailFlag||t.text("QC Failed")},PathOS.igv={loaded:!1,options:{},init:function(e,t,a,n,o){var s=t+a+".bai",i=t+a+".bam",l=t+a+".vcf",d=t.split("Pathology")[0],r=d+"Panels/"+n+"/Amplicon.bed",c=d+"Panels/"+n+"/Amplicon.tsv";PathOS.igv.div=e,PathOS.igv.options={showKaryo:"hide",showNavigation:!0,showCenterGuide:!0,reference:{fastaURL:"//dn7ywbm9isq8j.cloudfront.net/genomes/seq/hg19/hg19.fasta",indexFile:"/PathOS/igv/hg19.fasta.fai",cytobandURL:"/PathOS/igv/cytoBand.txt",order:-9999},tracks:[{url:l,type:"vcf",label:"VCF: "+a,order:-10001},new PathOS.igv.BAM(s,i,a,o),{name:n,url:r,indexURL:c,displayMode:"EXPANDED",order:-9998},{url:"/PathOS/igv/hg19-RefSeqGenes.gtf.gz",indexURL:"/PathOS/igv/hg19-RefSeqGenes.gtf.gz.tbi",name:"hg19 - Gencode v24",format:"gtf",order:-9997,visibilityWindow:1e7}]}},search:function(e){PathOS.igv.loaded||(PathOS.igv.loaded=!0,igv.createBrowser(PathOS.igv.div,PathOS.igv.options),$("#footer-message").remove()),igv.browser.search(e)},addBAM:function(e,t,a){if(e&&t){var n=t+e+".bai",o=t+e+".bam",s=new PathOS.igv.BAM(n,o,e,a);PathOS.igv.loaded?igv.browser.loadTrack(s):PathOS.igv.options.tracks.push(s)}else alert("There was an error, data not found.")},BAM:function(e,t,a,n){return n=n||2500,this.indexURL=e,this.url=t,this.label=a,this.type="bam",this.alignmentRowHeight=1,this.maxRows=99999,this.order=-1e4,this.height=500,this.autoHeight=!0,this.samplingDepth=n,this.colorBy="strand",this.negStrandColor="rgb(150, 150, 230)",this.posStrandColor="rgb(230, 150, 150)",this.deletionColor="black",this.skippedColor="rgb(150, 170, 170)",this}},PathOS.init=function(e){PathOS.modules.init(e),PathOS.hotkeys.init(),PathOS.history.init()};